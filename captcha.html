<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Turnstile</title>

  <link rel="preconnect" href="https://challenges.cloudflare.com">
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

  <style>
    body { margin:0; font-family: Arial, sans-serif; background: transparent; }
    .wrap { display:flex; align-items:center; justify-content:center; height:100vh; }
    .hint { color:#666; font-size:14px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hint">Verificandoâ€¦</div>
    <div class="cf-turnstile"
         data-sitekey="0x4AAAAAACNJalFqU3pVBzT2"
         data-callback="onSuccess"
         data-error-callback="onError"
         data-expired-callback="onExpired"
         data-timeout-callback="onError"
         data-size="invisible"></div>
  </div>

  <script>
    function send(msg) {
      // webview_flutter JavaScriptChannel
      if (window.Captcha && window.Captcha.postMessage) {
        window.Captcha.postMessage(String(msg));
      }
    }

    function goDone(fragment) {
      // Token is stored in URL fragment (#...), not sent to the server.
      // This lets Windows WebView2 capture it via URL changes.
      window.location.replace('captcha_done.html#' + fragment);
    }

    function onSuccess(token) {
      const t = (token || '').trim();
      if (!t) {
        send("ERROR");
        goDone("error=EMPTY");
        return;
      }
      send(t);
      goDone("token=" + encodeURIComponent(t));
    }

    function onError() {
      send("ERROR");
      goDone("error=ERROR");
    }

    function onExpired() {
      send("EXPIRED");
      goDone("error=EXPIRED");
    }
  </script>
</body>
</html>
